#pragma version 10

// ╔══════════════════════════════════════════════════════════════════╗
// ║  Agent Spending Policy — Delegated Logic Signature              ║
// ║                                                                  ║
// ║  A stateless TEAL Smart Signature that mathematically bounds    ║
// ║  agent spending at the AVM consensus level. When an agent's     ║
// ║  Algorand account delegates authority to this LogicSig, every   ║
// ║  transaction the agent submits must satisfy ALL assertions      ║
// ║  below — otherwise the AVM rejects it before execution.         ║
// ║                                                                  ║
// ║  Policy Rules:                                                   ║
// ║    1. Maximum fee: 1000 microAlgo (prevents fee draining)       ║
// ║    2. Transaction type: ASA Transfer only (type enum 4)         ║
// ║    3. Asset ID: USDC on Algorand Mainnet (ASA 31566704)         ║
// ║    4. Exact toll: 10000 base units (0.01 USDC, 6 decimals)     ║
// ║    5. Maximum spend: 50 USDC per transaction (50,000,000 μUSDC) ║
// ╚══════════════════════════════════════════════════════════════════╝

// ── Rule 1: Fee Ceiling ─────────────────────────────────────────
// Reject any transaction with a fee exceeding 1000 microAlgo.
// This prevents a compromised agent from inflating fees to drain
// the delegating account's ALGO balance.
txn Fee
int 1000
<=
assert

// ── Rule 2: Transaction Type Restriction ────────────────────────
// Only allow Asset Transfer transactions (TypeEnum == 4).
// This prevents the agent from issuing payments, application
// calls, key registrations, or any other transaction type.
// The agent can ONLY move ASAs — nothing else.
txn TypeEnum
int 4
==
assert

// ── Rule 3: Asset ID Verification ──────────────────────────────
// Only allow transfers of USDC on Algorand Mainnet (ASA 31566704).
// This prevents the agent from moving any other ASA.
txn XferAsset
int 31566704
==
assert

// ── Rule 4: Exact Toll Amount ───────────────────────────────────
// The x402 toll must be exactly 10000 base units (0.01 USDC).
// USDC uses 6 decimals: 10000 / 10^6 = 0.01.
// This enforces the flat micro-payment pricing model.
txn AssetAmount
int 10000
==
assert

// ── Rule 5: Per-Transaction Spending Cap ────────────────────────
// Cap each ASA transfer at 50,000,000 micro-units (50 USDC).
// Even if the delegating account holds millions of USDC, a
// single agent transaction can never move more than 50 USDC.
// (Redundant with Rule 4's exact check, but retained as a
// defense-in-depth ceiling for future toll adjustments.)
txn AssetAmount
int 50000000
<=
assert

// ── Verdict ─────────────────────────────────────────────────────
// All assertions passed. Approve the transaction.
int 1
return
